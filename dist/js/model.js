"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function instanceOf(e){return e.constructor.prototype.modelName||e.constructor.name}function className(e){return e.prototype.modelName||e.prototype.constructor.name}var cache={};function clear(e){if(1<arguments.length&&void 0!==arguments[1]&&arguments[1]){var t=!0,n=!1,r=void 0;try{for(var o,a=e.get()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var i=o.value;delete cache[className(e)][i.id]}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}else{var c=cache[instanceOf(e)];c&&delete c[e.id]}}function get(e,t){if(cache[e])return t?cache[e][t]&&cache[e][t].instance:cache[e]}function set(e){var t=e.id,n=instanceOf(e),r=(new Date).toISOString();cache[n]||(cache[n]={});var o=cache[n][t];o?(o.instance=e,o.updated=r,cache[n][t]=o):cache[n][t]={created:r,instance:e}}var hooks={};function id(e){return instanceOf(e)+e.id}function get$1(e){return hooks[id(e)]||{onbeforedelete:[],onbeforeupdate:[]}}function set$1(e,t,n){var r=id(e),o=hooks[r];o||(hooks[r]={onbeforedelete:[],onbeforeupdate:[]},o=hooks[r]),o[t].push(n)}function getById(e,t){return get(className(e),t)}function getByIds(e,t){var n=get(className(e)),r=[];for(var o in n){var a=n[o].instance,i=!0,c=!1,u=void 0;try{for(var l,s=t[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var f=l.value;if(a.id===f){r.push(a);break}}}catch(e){c=!0,u=e}finally{try{i||null==s.return||s.return()}finally{if(c)throw u}}}return r}function getByProperties(e,t){var n=get(className(e)),r=[];for(var o in n){var a=n[o].instance,i=!0;for(var c in t)if(a[c]!==t[c]){i=!1;break}i&&r.push(a)}return r}function getInstances(e){var t=get(className(e)),n=[];for(var r in t)n.push(t[r].instance);return n}var Model=function(){function t(e){if(_classCallCheck(this,t),!e.id)throw new Error("Model.js: cannot create instance without an id!");return Object.assign(this,e),new Proxy(this,{get:function(e,t,n){return Reflect.get(e,t,n)},set:function(e,t,n){var r=!0,o=!1,a=void 0;try{for(var i,c=get$1(this).onbeforeupdate[Symbol.iterator]();!(r=(i=c.next()).done);r=!0){(0,i.value)(t,e[t],n)}}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return Reflect.set(e,t,n)}}),this}return _createClass(t,[{key:"delete",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=get$1(this).onbeforedelete[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){(0,r.value)()}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}clear(this)}},{key:"onbeforedelete",value:function(e){set$1(this,"onbeforedelete",e)}},{key:"onbeforeupdate",value:function(e){set$1(this,"onbeforeupdate",e)}},{key:"save",value:function(){set(this)}}],[{key:"delete",value:function(){clear(this,!0)}},{key:"first",value:function(e){return this.get(e)[0]}},{key:"get",value:function(e){var t=_typeof(e);return"undefined"===t?getInstances(this):/string|number/.test(t)?getById(this,e):e instanceof Array&&0<e.length?getByIds(this,e):e instanceof Object?getByProperties(this,e):void 0}},{key:"loadJSON",value:function(l){var s=this;return new Promise(function(e){var t=l&&l.length;if(t){var n=0,r=!0,o=!1,a=void 0;try{for(var i,c=l[Symbol.iterator]();!(r=(i=c.next()).done);r=!0){var u=i.value;new s(u).save(),++n===t&&e(n)}}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}}else e()})}}]),t}();module.exports=Model;